/*

After changes:
1. Go to https://esprima.org/demo/minify.html and paste this document.
2. Select the checkbox "Shorten variable names".
3. Copy the result and paste it in "functions.min.js"

 */


const cssBreakpoint = 1110;

/* Slideshow Section */

let acc = document.getElementById("accordion").getElementsByClassName("item");

// Add Event listener to every accordion item
for (let i = 0; i < acc.length; i++) {
    acc[i].getElementsByClassName("header")[0].addEventListener("click", function () {
        if (acc[i] === document.getElementsByClassName("item active")[0]) {
            // Toggle clicked Element
            acc[i].classList.toggle("active");
            let panel = acc[i].getElementsByClassName("content")[0];
            panel.style.maxHeight = null;
        } else {
            // Hide current active
            let panel;
            if (document.getElementsByClassName("item active").length > 0) {
                panel = document.getElementsByClassName("item active")[0].getElementsByClassName("content")[0];
                panel.style.maxHeight = null;
                document.getElementsByClassName("item active")[0].classList.toggle("active");
            }
            //	Show clicked
            acc[i].classList.toggle("active");
            panel = acc[i].getElementsByClassName("content")[0];
            panel.style.maxHeight = panel.scrollHeight + "px";
            addIndicators(document.getElementsByClassName("item active")[0].getElementsByClassName("slideshow")[0].getElementsByClassName("slides-indicator")[0], document.getElementsByClassName("item active")[0].getElementsByClassName("slide").length);
        }
        setTimeout(function () {
            document.getElementById("scrollbar").style.transition = "top 0.2s";
            scrollMarius();
            setTimeout(function () {
                document.getElementById("scrollbar").style.transition = "none";
            }, 200)
        }, 200);
    });
}

function addIndicators(el, number) {
    let html = "";
    for (let i = 0; i < number; i++) {
        if (i == 0) {
            html += "<hr class='active'>";
        } else {
            html += "<hr>";
        }
    }
    el.innerHTML = html;
}


/**
 * Refreshs the heights for the content of an project item in the accordion
 */
function refreshHeights() {
    let active = document.getElementsByClassName("item active")[0];

    let width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    if (width < cssBreakpoint && active) {
        let children = active.getElementsByClassName("content")[0].children;
        let height = 0;
        for (let i = 0; i < children.length; i++) {
            height += children[i].scrollHeight;
            if (children[i].tagName === "BR") {
                height += 24;
            }
        }
        active.getElementsByClassName("content")[0].style.maxHeight = height + "px";
    } else if (active) {
        active.getElementsByClassName("content")[0].style.maxHeight = active.scrollHeight + "px";
    }
}

// Attaching the event listener function to window's resize event
window.addEventListener("resize", refreshHeights);

/**
 * Changes the slides (endless)
 * @param direction 1: Next slide | 0: Previous slide
 */
function changeSlide(direction) {
    let slideshow = document.getElementsByClassName("item active")[0].getElementsByClassName("slideshow")[0];
    let currentSlideshowIndicator = slideshow.getElementsByClassName("slides-indicator")[0].getElementsByClassName("active")[0];
    let currentSlide = slideshow.getElementsByClassName("slide active")[0];

    // Next Slide
    if (direction && currentSlide.nextElementSibling !== null) {
        currentSlide.classList.remove("active");
        currentSlide.nextElementSibling.classList.add("active");
        currentSlideshowIndicator.classList.remove("active");
        currentSlideshowIndicator.nextElementSibling.classList.add("active");
    }
    // Previous Slide
    else if (!direction && currentSlide.previousElementSibling !== null) {
        currentSlide.classList.remove("active");
        currentSlide.previousElementSibling.classList.add("active");
        currentSlideshowIndicator.classList.remove("active");
        currentSlideshowIndicator.previousElementSibling.classList.add("active");
    }
    // Next Slide at last slide -> First slide
    else if (currentSlide.nextElementSibling == null) {
        currentSlide.classList.remove("active");
        slideshow.getElementsByClassName("slides")[0].getElementsByClassName("slide")[0].classList.add("active");
        currentSlideshowIndicator.classList.remove("active");
        currentSlideshowIndicator.parentElement.getElementsByTagName("hr")[0].classList.add("active");
    }
    // previous slide at first slide -> Last slide
    else if (currentSlide.previousElementSibling == null) {
        currentSlide.classList.remove("active");
        let slides = slideshow.getElementsByClassName("slides")[0].getElementsByClassName("slide");
        slides[slides.length - 1].classList.add("active");
        currentSlideshowIndicator.classList.remove("active");
        let hrs = currentSlideshowIndicator.parentElement.getElementsByTagName("hr");
        currentSlideshowIndicator.parentElement.getElementsByTagName("hr")[hrs.length - 1].classList.add("active");
    }
    refreshHeights();
}

/* Slideshow Section End */

/* Left Column Section */

/**
 * Change the left text to param text
 * @param text shown text
 */
function changeSideText(text) {
    document.getElementById("caption").innerText = text;
}

/* Left Column Section End */
/* Background Color Section */
/*

let color = 0;
document.getElementsByTagName("body")[0].addEventListener('mousemove', function () {
	if (color > 360) {
		color = 0;
	}
	color = color + 2;
	// Check out HSl color wheel: https://www.w3schools.com/colors/colors_hsl.asp
	document.getElementsByClassName("right-col")[0].style.backgroundColor = 'hsl(' + color + ', 100%, 85%)';
});

/*
/* Background Color Section End*/
/* Scroll Section */

var active = false;
var currentY;
var initialY;
var yOffset = 0;

/**
 * Sets the offset height of the MARIUS WIES div if a user scrolls in the content area
 */
function scrollMarius() {
    let width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    // Adjust next line with css breakpoints!
    if (width > cssBreakpoint) {
        let windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        let sectionHeight = document.getElementsByClassName("section")[0].offsetHeight + document.getElementsByClassName("section")[1].offsetHeight + document.getElementsByClassName("section")[2].offsetHeight;
        let scrolled = document.getElementsByClassName("mid-col")[0].scrollTop;
        let overflow = sectionHeight - windowHeight;
        let percent = scrolled / overflow;
        let mariusway = windowHeight - document.getElementById("scrollbar").offsetHeight - 80; // 80px padding bottom
        yOffset = percent * mariusway + 40; // 40 px padding top
        document.getElementById("scrollbar").style.top = yOffset + "px";
    } else {
        document.getElementById("scrollbar").style.top = "10px";
    }
}

/**
 * Gets fired when the user starts draging MARIUS WIES
 * @param e mouse event
 */
function dragStart(e) {
    initialY = e.clientY - yOffset;
    active = true;
    drag(e);
    document.addEventListener("mousemove", drag);
    document.addEventListener("mouseup", dragEnd);
}

/**
 * Gets fired when the user stops draging MARIUS WIES
 */
function dragEnd() {
    active = false;
    document.removeEventListener("mousemove", drag);
    document.removeEventListener("mouseup", dragEnd);
}

/**
 * Moves the MARIUS WIES div
 * Scrolls the content to the corresponding offset from MARIUS WIES div
 * @param e mouse event
 */
function drag(e) {
    if (active) {

        //Scroll the name
        e.preventDefault();
        currentY = e.clientY - initialY;
        yOffset = currentY;
        let windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        if (yOffset > (windowHeight - document.getElementById("scrollbar").offsetHeight - 40)) {
            yOffset = windowHeight - document.getElementById("scrollbar").offsetHeight - 40;
        } else if (yOffset < 40) {
            yOffset = 40;
        }
        document.getElementById("scrollbar").style.top = yOffset + "px";

        // Scroll the content div
        let percent = (yOffset - 40) / (windowHeight - document.getElementById("scrollbar").offsetHeight - 80);
        let sectionHeight = document.getElementsByClassName("section")[0].offsetHeight + document.getElementsByClassName("section")[1].offsetHeight + document.getElementsByClassName("section")[2].offsetHeight;
        let overflow = sectionHeight - windowHeight;
        document.getElementsByClassName("mid-col")[0].scrollTop = overflow * percent;
    }
}

/* Scroll Section End */

showPic = true;
function marius(){
    if(showPic){
        document.getElementById("mariusFullscreen").classList.add("show");
        showPic = false;
        setTimeout(()=> {
            document.getElementById("mariusFullscreen").classList.remove("show");
        }, 250);
        setTimeout(()=> {
            showPic = true;
        }, 5000);
    }
}

document.getElementById("hoverHere").addEventListener("mouseover", marius);

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
    const newColorScheme = e.matches ? "dark" : "light";
    if (newColorScheme === "dark") {
        document.getElementById("scrollbar-white").classList.remove("hidden");
        document.getElementById("scrollbar-black").classList.add("hidden");
    } else{
        document.getElementById("scrollbar-black").classList.remove("hidden");
        document.getElementById("scrollbar-white").classList.add("hidden");
    }
});

document.addEventListener("DOMContentLoaded", function(event) {
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
     document.getElementById("scrollbar-white").classList.remove("hidden");
        document.getElementById("scrollbar-black").classList.add("hidden");
}
});
